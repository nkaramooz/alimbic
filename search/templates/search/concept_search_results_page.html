
{% load app_filters %}
{% load staticfiles %}
{% include 'search/header_template.html' %}
<script src="{% static "js/search-results.js" %}"></script>

<div class="title_header">
	<h1> Concept Search </h1>
</div>

{% url 'search:concept_search' as concept_search %}
{% url 'search:pivot_search' as pivot %}
{% include 'search/search_bar_template.html' with action=concept_search %}


<div class="body">

	<div class="query-display">
		<h5>
			{% for concept in concepts %}
				<i> {{concept.conceptid}} : {{concept.term}} </i>
			{% endfor %} 
		</h5>
	</div>

	
	{% include 'search/vanco_calc.html' %}
<!--
	<div id="carouselExampleControls" class="carousel slide" data-interval="false">
  <div class="carousel-inner" role="listbox">
    <div class="carousel-item active">
    	<div class="card">
  			<div class="card-block">
    			<h4 class="card-title">Card title</h4>
    			<p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
    			<a href="#" class="btn btn-primary">Go somewhere</a>
  			</div>
		</div>
    </div>
    <div class="carousel-item">
      22222222
    </div>
    <div class="carousel-item">
      33333333
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>
-->


	<div class="glance">

		<div class="list-group">
			{% for k1,v1 in at_a_glance.related.items %}

				{% for k2,v2 in v1.items %}

					{% if k2 == 'treatment' %}
						<h5> Procedures / Treatments </h5>
							{% for x in v2 %}
								<form action={{pivot}} method="post"> 
									{% csrf_token %}
										<input type="hidden" name="conceptid1" value="{{k1}}">
										<input type="hidden" name="conceptid2" value="{{x.conceptid}}">
										<input type="hidden" name="term1" value="{{v1.term}}">
										<input type="hidden" name="term2" value="{{x.term}}">
										<input type="submit" value="{{x.term}} -- {{x.count}} papers" >
								</form>
							{% endfor %}

					{% elif k2 == 'diagnostic' %}
						<h5> Diagnostic </h5>
						{% for x in v2 %}
							<form action={{pivot}} method="post"> 
								{% csrf_token %}
									<input type="hidden" name="conceptid1" value="{{k1}}">
									<input type="hidden" name="conceptid2" value="{{x.conceptid}}">
									<input type="hidden" name="term1" value="{{v1.term}}">
									<input type="hidden" name="term2" value="{{x.term}}">
									<input type="submit" value="{{x.term}} -- {{x.count}} papers" >
							</form>
						{% endfor %}
					{% endif %}
				
				{% endfor %}	
			{% endfor %}
		</div>

	
	{% include 'search/sr_template.html' with sr_payload=sr_payload %}
</div>
