
{% load app_filters %}
{% load staticfiles %}
{% include 'search/header_template.html' %}
<script src="{% static "js/search-results.js" %}"></script>

<nav class="navbar navbar-expand-sm navbar-light" style="background-color: #e3f2fd;">

		<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
			<div class="navbar-nav">
				<a class="nav-item nav-link active" href="/concept_search_home_page">Search</a>
				<a class="nav-item nav-link" href="/vancocalc">Vancomycin</a>

			</div>
		</div>
	</nav>

{% url 'search:concept_search' as concept_search %}
{% url 'search:pivot_search' as pivot %}
{% include 'search/search_bar_template.html' with action=concept_search %}


<div class="body">

	<div class="query-display">
		<h5>
			{% for concept in concepts %}
				<i> {{concept.conceptid}} : {{concept.term}} </i>
			{% endfor %} 
		</h5>
	</div>

	





	<div class="glance">

		<div class="list-group">
			{% for k1,v1 in at_a_glance.related.items %}

				{% for k2,v2 in v1.items %}

					{% if k2 == 'treatment' %}
						<div class="glance_topic">
							<h5> Procedures / Treatments ({{v2|length}})</h5>
							<div id="treatment" class="carousel slide" data-interval="false">
	  						<div class="carousel-inner" role="listbox">

								{% for x in v2 %}
									{% if forloop.counter0 == 0 %}
										<div class="carousel-item active">
									{% else %}
										<div class="carousel-item">
									{% endif %}

										<div class="card">
		  									<div class="card-block">
		    									<h4 class="card-title">{{x.term}}</h4>
		    									<p class="card-text">{{x.count}} papers</p>
		    									<form action="association_override" method="post">
		    										{% csrf_token %}
		    											Error present? <br>
		    											<input type="radio" name="error_present" value="true"> Yes <br>
		    											<input type="radio" name="error_present" value="false"> No <br>
		    											<br>
		    											Error type: <br>
		    											<input type="radio" name="error_type" value="annotation_error"> Annotation error <br>
		    											<input type="radio" name="error_type" value="global_mistype"> Global mistype error <br>
		    											<input type="radio" name="error_type" value="contextual_mistype"> Contextual mistype error <br>
		    											<br>
		    											Select correct concept type: <br>
		    												<input type="radio" name="concept_type" value="symptom"> Symptom <br>
		    												<input type="radio" name="concept_type" value="condition"> Condition <br>
		    												<input type="radio" name="concept_type" value="diagnostic"> Diagnostic <br>
		    												<input type="radio" name="concept_type" value="cause"> Cause <br>
		    												<input type="radio" name="concept_type" value="treatment"> Treatment <br>
		    												<input type="radio" name="concept_type" value="disease"> Associated disease <br>
		    												<input type="radio" name="concept_type" value="screening"> Screening test <br>
		    												<input type="radio" name="concept_type" value="prevention"> Prevention measure<br>
		    												<input type="radio" name="concept_type" value="none"> None <br>
		    												<input type="radio" name="concept_type" value="pathophysiology"> Pathophysiology mechanism </br>

		    									</form>
		    									<form action={{pivot}} method="post"> 
													{% csrf_token %}
														<input type="hidden" name="conceptid1" value="{{k1}}">
														<input type="hidden" name="conceptid2" value="{{x.conceptid}}">
														<input type="hidden" name="term1" value="{{v1.term}}">
														<input type="hidden" name="term2" value="{{x.term}}">
														<input type="submit" value="View" class="btn btn-primary">
												</form>
		  									</div>
										</div>
									</div>
									
								{% endfor %}
								<a class="carousel-control-prev" href="#treatment" role="button" data-slide="prev">
	    							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
	    							<span class="sr-only">Previous</span>
	  							</a>
								<a class="carousel-control-next" href="#treatment" role="button" data-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"></span>
							    	<span class="sr-only">Next</span>
								</a>
							</div>
						</div>
					</div>
					{% elif k2 == 'diagnostic' %}
						<div class="glance_topic">
							<h5> Diagnostic ({{v2|length}})</h5>
							<div id="diagnostic" class="carousel slide" data-interval="false">
		  						<div class="carousel-inner" role="listbox">

								{% for x in v2 %}
									{% if forloop.counter0 == 0 %}
										<div class="carousel-item active">
									{% else %}
										<div class="carousel-item">
									{% endif %}
									
									<div class="card">
			  							<div class="card-block">
				    						<h4 class="card-title">{{x.term}}</h4>
				    						<p class="card-text">{{x.count}} papers</p>
				    						<form action="association_override" method="post">
		    										{% csrf_token %}
		    											Error present? <br>
		    											<input type="radio" name="error_present" value="true"> Yes <br>
		    											<input type="radio" name="error_present" value="false"> No <br>
		    											<br>
		    											Error type: <br>
		    											<input type="radio" name="error_type" value="annotation_error"> Annotation error <br>
		    											<input type="radio" name="error_type" value="global_mistype"> Global mistype error <br>
		    											<input type="radio" name="error_type" value="contextual_mistype"> Contextual mistype error <br>
		    											<br>
		    											Select correct concept type: <br>
		    												<input type="radio" name="concept_type" value="symptom"> Symptom <br>
		    												<input type="radio" name="concept_type" value="condition"> Condition <br>
		    												<input type="radio" name="concept_type" value="diagnostic"> Diagnostic <br>
		    												<input type="radio" name="concept_type" value="cause"> Cause <br>
		    												<input type="radio" name="concept_type" value="treatment"> Treatment <br>
		    												<input type="radio" name="concept_type" value="disease"> Associated disease <br>
		    												<input type="radio" name="concept_type" value="screening"> Screening test <br>
		    												<input type="radio" name="concept_type" value="prevention"> Prevention measure<br>
		    												<input type="radio" name="concept_type" value="none"> None <br>
		    												<input type="radio" name="concept_type" value="pathophysiology"> Pathophysiology mechanism </br>

		    								</form>
				    						<form action={{pivot}} method="post"> 
												{% csrf_token %}
													<input type="hidden" name="conceptid1" value="{{k1}}">
													<input type="hidden" name="conceptid2" value="{{x.conceptid}}">
													<input type="hidden" name="term1" value="{{v1.term}}">
													<input type="hidden" name="term2" value="{{x.term}}">
													<input type="submit" value="View" class="btn btn-primary">
											</form>
										</div>
									</div>
								</div>
						{% endfor %}

						<a class="carousel-control-prev" href="#diagnostic" role="button" data-slide="prev">
    							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
    							<span class="sr-only">Previous</span>
  							</a>
							<a class="carousel-control-next" href="#diagnostic" role="button" data-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
						    	<span class="sr-only">Next</span>
							</a>
						</div>
					</div>
					</div>
					{% endif %}
				
				{% endfor %}	
			{% endfor %}
		</div>

	
	{% include 'search/sr_template.html' with sr_payload=sr_payload %}
</div>
