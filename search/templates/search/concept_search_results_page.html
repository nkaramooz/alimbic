{% load app_filters %}
{% load staticfiles  %}

<script src="{% static "js/collapsible.js" %}"></script>
<script src="{% static "js/pivot.js" %}"></script>

<div class="container">
	<div class="row">
	<div class="col s1"></div>
	<div class="col s11">
	<div class="query-display">
		<h5>
			{% for concept in concepts %}
				<i> {{concept.conceptid}} : {{concept.term}} </i>
			{% endfor %} 
		</h5>

		{% for i in query_annotation %}
			<input type="hidden" name="query_annotation[]" id="query_annotation" value="{{i}}">
		{% endfor %}
		<input type="hidden" name="unmatched_terms" id="unmatched_terms" value="{{unmatched_terms}}">
	</div>


	{% if treatment|length > 0 or diagnostic|length > 0 or cause|length > 0 or condition|length > 0 or calcs|length > 0 %}
		<div class="glance">
			
			<ul class="collapsible">
				

				{% if treatment|length > 0 %}
					<li>
						<div class="collapsible-header"> Interventions / Drugs <span class="new badge" data-badge-caption="topics">{{treatment|length}}</span></div>
						<div class="collapsible-body">
							<ul class="default-browser">
								{% for node in treatment %}
									{% include 'search/nested_view_template.html' with pivot_type='treatment' %}
								{% endfor %}
							</ul>
						</div>
					</li>						
				{% endif %}
				

				{% if diagnostic|length > 0 %}
					<li>
						<div class="collapsible-header"> Diagnostics <span class="new badge" data-badge-caption="topics">{{diagnostic|length}}</span></div>
						<div class="collapsible-body">
							<ul class="">
								{% for node in diagnostic %}
									{% include 'search/nested_view_template.html' with pivot_type='diagnostic' %}
								{% endfor %}
							</ul>

						</div>
					</li>
				{% endif %}

				{% if cause|length > 0 %}
		      		<li>
		      			<div class="collapsible-header"> Organisms <span class="new badge" data-badge-caption="topics">{{cause|length}}</span></div>
		      			<div class="collapsible-body">
		      				<ul class="">
								{% for node in cause %}
									{% include 'search/nested_view_template.html' with pivot_type='cause' %}
								{% endfor %}
							</ul>

						</div>
					</li>
				{% endif %}


				{% if condition|length > 0 %}
					<li>
		      			<div class="collapsible-header"> Conditions <span class="new badge" data-badge-caption="topics">{{condition|length}}</span></div>
		      			<div class="collapsible-body">
		      				<ul class="">
								{% for node in condition %}
									{% include 'search/nested_view_template.html' with pivot_type='condition' %}
								{% endfor %}
							</ul>

						</div>
					</li>
						
				{% endif %}

				{% if calcs|length > 0 %}
					<li>
		      			<div class="collapsible-header"> Calculators <span class="new badge" data-badge-caption="calculators">{{calcs|length}}</span></div>
		      			<div class="collapsible-body">
		      				<ul class="">
								{% for c in calcs %}
									<li>
										<form class="inline-form" action=# method="get">
											{% csrf_token %}
											<a target="_blank" href="https://{{c.url}}" class=""> {{c.title}}</a> <br>
											{{c.desc}}
										</form>
									</li>
								{% endfor %}
							</ul>

						</div>
					</li>
		
				{% endif %}
			

			
			</ul>
		</div>
	{% endif %}
<!-- 			{% for k1,v1 in at_a_glance.related.items %}

				{% for k2,v2 in v1.items %} -->

	
							<!-- <div id="treatment" class="carousel slide" data-interval="false">
	  						<div class="carousel-inner" role="listbox">

								{% for x in v2 %}
									{% if forloop.counter0 == 0 %}
										<div class="carousel-item active">
									{% else %}
										<div class="carousel-item">
									{% endif %}

										<div class="card">
		  									<div class="card-block">
		    									<h4 class="card-title">{{x.term}}</h4>
		    									<p class="card-text">{{x.count}} papers</p>
		    									<form action=# method="post">
		    										{% csrf_token %}
		    											Error present? <br>
		    											<input type="radio" name="error_present" value="true"> Yes <br>
		    											<input type="radio" name="error_present" value="false"> No <br>
		    											<br>
		    											Error type: <br>
		    											<input type="radio" name="error_type" value="annotation_error"> Annotation error <br>
		    											<input type="radio" name="error_type" value="global_mistype"> Global mistype error <br>
		    											<input type="radio" name="error_type" value="contextual_mistype"> Contextual mistype error <br>
		    											<input type="radio" name="error_type" value="too_broad"> Too broad <br>
		    											<br>
		    											Select correct concept type: <br>
		    												<input type="radio" name="concept_type" value="symptom"> Symptom <br>
		    												<input type="radio" name="concept_type" value="condition"> Condition <br>
		    												<input type="radio" name="concept_type" value="diagnostic"> Diagnostic <br>
		    												<input type="radio" name="concept_type" value="cause"> Cause <br>
		    												<input type="radio" name="concept_type" value="treatment"> Treatment <br>
		    												<input type="radio" name="concept_type" value="disease"> Associated disease <br>
		    												<input type="radio" name="concept_type" value="screening"> Screening test <br>
		    												<input type="radio" name="concept_type" value="risk factor"> Risk factor <br>
		    												<input type="radio" name="concept_type" value="prevention"> Prevention measure<br>
		    												<input type="radio" name="concept_type" value="none"> None <br>
		    												<input type="radio" name="concept_type" value="pathophysiology"> Pathophysiology mechanism </br>
		    												<input type="radio" name="concept_type" value="associated_treatment"> Associated treatment </br>
		    												<input type="radio" name="concept_type" value="associated_diagnostic"> Associated diagnostic </br>
		    												<input type="radio" name="concept_type" value="research_test"> Research test </br>
		    												<input type="hidden" name="query" value="{{query}}">
		    												<input type="hidden" name="curr_concept_type" value={{k2}}>
		    												<input type="hidden" name="associated_cid" value="{{k1}}">
															<input type="hidden" name="root_cid" value="{{x.conceptid}}">
		    												{{k1}}
		    												{{x.conceptid}}
		    												{{query}}
		    											<input type="submit" name="concept_type_override" value="Change" class="btn btn-danger">
		    									</form>
		    									<form action=# method="get"> 
													{% csrf_token %}
														<input type="hidden" name="pivot_cid" value="{{x.conceptid}}">
														<input type="hidden" name="term1" value="{{v1.term}}">
														<input type="hidden" name="term2" value="{{x.term}}">
														<input type="hidden" name="query_type" value="pivot">
														<input type="hidden" name="pivot_type" value="treatment">
														{% for c in primary_cids %}
															<input type="hidden" name="primary_cids[]" value="{{c}}">
														{% endfor %}
														{% for j in journals %}
															<input type="hidden" name="journals[]" value="{{j}}">
														{% endfor %}
														<input type="submit" value="View" class="btn btn-primary">
												</form>
		  									</div>
										</div>
									</div>
									
								{% endfor %}
								<a class="carousel-control-prev" href="#treatment" role="button" data-slide="prev">
	    							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
	    							<span class="sr-only">Previous</span>
	  							</a>
								<a class="carousel-control-next" href="#treatment" role="button" data-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"></span>
							    	<span class="sr-only">Next</span>
								</a> -->
					
					
		
<!-- 
							<h5> Diagnostic ({{v2|length}})</h5>
							<div id="diagnostic" class="carousel slide" data-interval="false">
		  						<div class="carousel-inner" role="listbox">

								{% for x in v2 %}
									{% if forloop.counter0 == 0 %}
										<div class="carousel-item active">
									{% else %}
										<div class="carousel-item">
									{% endif %}
									
									<div class="card">
			  							<div class="card-block">
				    						<h4 class="card-title">{{x.term}}</h4>
				    						<p class="card-text">{{x.count}} papers</p>
				    						<form action=# method="post">
		    										{% csrf_token %}
		    											Error present? <br>
		    											<input type="radio" name="error_present" value="true"> Yes <br>
		    											<input type="radio" name="error_present" value="false"> No <br>
		    											<br>
		    											Error type: <br>
		    											<input type="radio" name="error_type" value="annotation_error"> Annotation error <br>
		    											<input type="radio" name="error_type" value="global_mistype"> Global mistype error <br>
		    											<input type="radio" name="error_type" value="contextual_mistype"> Contextual mistype error <br>
		    											<input type="radio" name="error_type" value="too_broad"> Too broad <br>
		    											<br>
		    											Select correct concept type: <br>
		    												<input type="radio" name="concept_type" value="symptom"> Symptom <br>
		    												<input type="radio" name="concept_type" value="condition"> Condition <br>
		    												<input type="radio" name="concept_type" value="diagnostic"> Diagnostic <br>
		    												<input type="radio" name="concept_type" value="cause"> Cause <br>
		    												<input type="radio" name="concept_type" value="treatment"> Treatment <br>
		    												<input type="radio" name="concept_type" value="disease"> Associated disease <br>
		    												<input type="radio" name="concept_type" value="screening"> Screening test <br>
		    												<input type="radio" name="concept_type" value="risk factor"> Risk factor <br>
		    												<input type="radio" name="concept_type" value="prevention"> Prevention measure<br>
		    												<input type="radio" name="concept_type" value="none"> None <br>
		    												<input type="radio" name="concept_type" value="pathophysiology"> Pathophysiology mechanism </br>
		    												<input type="radio" name="concept_type" value="associated_treatment"> Associated treatment </br>
		    												<input type="radio" name="concept_type" value="associated_diagnostic"> Associated diagnostic </br>
		    												<input type="radio" name="concept_type" value="research_test"> Research test </br>
		    												<input type="hidden" name="query" value="{{query}}">
		    												<input type="hidden" name="curr_concept_type" value={{k2}}>
		    												<input type="hidden" name="associated_cid" value="{{k1}}">
															<input type="hidden" name="root_cid" value="{{x.conceptid}}">
		    												{{k1}}
		    												{{x.conceptid}}
		    												{{query}}
		    											<input type="submit" name="concept_type_override" value="Change" class="btn btn-danger">

		    								</form>
				    						<form action=# method="get"> 
												{% csrf_token %}
													<input type="hidden" name="pivot_cid" value="{{x.conceptid}}">
													<input type="hidden" name="term1" value="{{v1.term}}">
													<input type="hidden" name="term2" value="{{x.term}}">
													<input type="hidden" name="query_type" value="pivot">
													<input type="hidden" name="pivot_type" value="diagnostic">
													{% for c in primary_cids %}
														<input type="hidden" name="primary_cids[]" value="{{c}}">
													{% endfor %}
													{% for j in journals %}
														<input type="hidden" name="journals[]" value="{{j}}">
													{% endfor %}
													<input type="submit" value="View" class="btn btn-primary">
											</form>
										</div>
									</div>
								</div>
						{% endfor %}

						<a class="carousel-control-prev" href="#diagnostic" role="button" data-slide="prev">
    							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
    							<span class="sr-only">Previous</span>
  							</a>
							<a class="carousel-control-next" href="#diagnostic" role="button" data-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
						    	<span class="sr-only">Next</span>
							</a>
						</div>
					</div>
					</div> -->
				<!-- 	{% if k2 == 'condition' %}
						<div class="glance_topic">
							<div class="accordion" id="conditionAccordion">
 								 <div class="card">
    								<div class="card-header" id="headingOne">
      									<h5 class="mb-0">
        									<button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#condition" aria-expanded="false" aria-controls="condition">
          									<h5> Conditions ({{v2|length}})</h5>
        									</button>
      									</h5>
   									</div>
									<div id="condition" class="collapse" aria-labelledby="headingTwo" data-parent="#conditionAccordion">
										<div class="card-body">
									    	<ul>
										      	{% for x in v2 %}
													<li>
														<form action=# method="get"> 
															{% csrf_token %}
															<input type="hidden" name="pivot_cid" value="{{x.conceptid}}">
															<input type="hidden" name="term1" value="{{v1.term}}">
															<input type="hidden" name="term2" value="{{x.term}}">
															<input type="hidden" name="query_type" value="pivot">
															<input type="hidden" name="pivot_type" value="condition">
															{% for c in primary_cids %}
																<input type="hidden" name="primary_cids[]" value="{{c}}">
															{% endfor %}
															{% for j in journals %}
																<input type="hidden" name="journals[]" value="{{j}}">
															{% endfor %}
															<input type="submit" value="{{x.term}} ({{x.count}} papers)" class="btn btn-link btn-sm">
														</form>
													</li>
												{% endfor %}
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
 -->
						<!-- <h5> Conditions ({{v2|length}})</h5>
							<div id="condition" class="carousel slide" data-interval="false">
		  						<div class="carousel-inner" role="listbox">

								{% for x in v2 %}
									{% if forloop.counter0 == 0 %}
										<div class="carousel-item active">
									{% else %}
										<div class="carousel-item">
									{% endif %}
									
									<div class="card">
			  							<div class="card-block">
				    						<h4 class="card-title">{{x.term}}</h4>
				    						<p class="card-text">{{x.count}} papers</p>
				    						<form action=# method="post">
		    										{% csrf_token %}
		    											Error present? <br>
		    											<input type="radio" name="error_present" value="true"> Yes <br>
		    											<input type="radio" name="error_present" value="false"> No <br>
		    											<br>
		    											Error type: <br>
		    											<input type="radio" name="error_type" value="annotation_error"> Annotation error <br>
		    											<input type="radio" name="error_type" value="global_mistype"> Global mistype error <br>
		    											<input type="radio" name="error_type" value="contextual_mistype"> Contextual mistype error <br>
		    											<input type="radio" name="error_type" value="too_broad"> Too broad <br>
		    											<br>
		    											Select correct concept type: <br>
		    												<input type="radio" name="concept_type" value="symptom"> Symptom <br>
		    												<input type="radio" name="concept_type" value="condition"> Condition <br>
		    												<input type="radio" name="concept_type" value="diagnostic"> Diagnostic <br>
		    												<input type="radio" name="concept_type" value="cause"> Cause <br>
		    												<input type="radio" name="concept_type" value="treatment"> Treatment <br>
		    												<input type="radio" name="concept_type" value="disease"> Associated disease <br>
		    												<input type="radio" name="concept_type" value="screening"> Screening test <br>
		    												<input type="radio" name="concept_type" value="risk factor"> Risk factor <br>
		    												<input type="radio" name="concept_type" value="prevention"> Prevention measure<br>
		    												<input type="radio" name="concept_type" value="none"> None <br>
		    												<input type="radio" name="concept_type" value="pathophysiology"> Pathophysiology mechanism </br>
		    												<input type="radio" name="concept_type" value="associated_treatment"> Associated treatment </br>
		    												<input type="radio" name="concept_type" value="associated_diagnostic"> Associated diagnostic </br>
		    												<input type="radio" name="concept_type" value="research_test"> Research test </br>
		    												<input type="hidden" name="query" value="{{query}}">
		    												<input type="hidden" name="curr_concept_type" value={{k2}}>
		    												<input type="hidden" name="associated_cid" value="{{k1}}">
															<input type="hidden" name="root_cid" value="{{x.conceptid}}">
		    												{{k1}}
		    												{{x.conceptid}}
		    												{{query}}
		    											<input type="submit" name="concept_type_override" value="Change" class="btn btn-danger">

		    								</form>
				    						<form action=# method="get"> 
												{% csrf_token %}
													<input type="hidden" name="pivot_cid" value="{{x.conceptid}}">
													<input type="hidden" name="term1" value="{{v1.term}}">
													<input type="hidden" name="term2" value="{{x.term}}">
													<input type="hidden" name="query_type" value="pivot">
													<input type="hidden" name="pivot_type" value="condition">
													{% for c in primary_cids %}
														<input type="hidden" name="primary_cids[]" value="{{c}}">
													{% endfor %}
													{% for j in journals %}
														<input type="hidden" name="journals[]" value="{{j}}">
													{% endfor %}
													<input type="submit" value="View" class="btn btn-primary">
											</form>
										</div>
									</div>
								</div>
						{% endfor %}

						<a class="carousel-control-prev" href="#condition" role="button" data-slide="prev">
    							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
    							<span class="sr-only">Previous</span>
  							</a>
							<a class="carousel-control-next" href="#condition" role="button" data-slide="next">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
						    	<span class="sr-only">Next</span>
							</a>
						</div>
					</div>
					</div> -->
					<!-- {% endif %} -->
				
				<!-- {% endfor %}	 -->
			<!-- {% endfor %} -->
		<!-- </div> -->

	<br>
	<br>
	<br>
	{% include 'search/sr_template.html' with sr_payload=sr_payload %}
</div></div></div>
